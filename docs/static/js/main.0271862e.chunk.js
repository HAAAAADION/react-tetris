(this.webpackJsonpinit=this.webpackJsonpinit||[]).push([[0],{151:function(e,t,n){e.exports=n(319)},218:function(e,t){},311:function(e,t,n){},312:function(e,t,n){},313:function(e,t,n){},314:function(e,t,n){},315:function(e,t,n){},316:function(e,t,n){},317:function(e,t,n){},318:function(e,t,n){},319:function(e,t,n){"use strict";n.r(t);var a,r,o,c=n(0),u=n.n(c),i=n(11),s=n.n(i),l=n(3),f=n(4),d=n.n(f),m=n(49),v=n(50),p="0",h="1",y="2",b=10,E={SPACE:32,LEFT:37,RIGHT:39,DOWN:40},x=(a={},Object(v.a)(a,E.LEFT,-1),Object(v.a)(a,E.RIGHT,1),a),S="START_GAME",g="RESET_GAME",O="SHAPE_CHANGE",j=n(97),_=function(e){var t;return(null===e||void 0===e||null===(t=e[0])||void 0===t?void 0:t.length)||0},w=function(e){return Math.floor(_(e)/2)},N=function(e,t){for(var n=[],a=0;a<e.length/t;a++)n.push(e.slice(t*a,t*a+t));return n},T=function(e){switch(Object.prototype.toString.call(e)){case"[object Array]":return e.length<=0;case"[object Object]":return Object.keys(e).length<=0;default:return void 0===e}},k=function(){return/Android|webOS|iPhone|iPad|BlackBerry/i.test(navigator.userAgent)},A=function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))},M=function(e){window._dva._store.dispatch(e)},P={updateState:function(e){M({type:"home/updateState",payload:e})},setX:function(e){M({type:"home/setX",payload:{x:e}})},setY:function(e){M({type:"home/setY",payload:{y:e}})},updateScore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;M({type:"home/updateScore",payload:{size:e}})},get state(){var e,t,n;return null===(e=window)||void 0===e||null===(t=e._dva)||void 0===t||null===(n=t._store)||void 0===n?void 0:n.getState()},get currentShape(){return Object(l.a)(this.state.home.shape).reverse()},get nextShape(){return Object(l.a)(this.state.home.nextShape).reverse()}},G=function(e,t){return e.reduce((function(e,n,a){return n===y&&(a<=t?e.min=a+1:a>t&&void 0===e.max&&(e.max=a-1)),e}),{})},L=function(){var e,t,n=(e=0,t=j.length-1,parseInt(Math.random()*(t-e+1)+e,10)),a=j[n];return Object(l.a)(a).reverse()},C=function(e,t,n){var a,r=(null===P||void 0===P||null===(a=P.state)||void 0===a?void 0:a.home)||{},o=r.shape,c=void 0===o?[]:o,u=r.body,i=n||c,s=!1,l=(void 0===u?[]:u).map((function(e){return e===h?p:e}));e:for(var f=0;f<i.length;f+=1)for(var d=0;d<i[f].length;d+=1){var m=(t-f)*b,v=e+d;if(1===i[f][d]&&l[m+v]===y){s={x:v,y:m};break e}}return s},D=function(e,t){var n,a=((null===P||void 0===P||null===(n=P.state)||void 0===n?void 0:n.home)||{}).body;return t>=N(void 0===a?[]:a,b).length||C(e,t)},H=function(){var e=Object(m.a)(d.a.mark((function e(t){var n,a,r,o,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:9,a=P.state.home.body,!((r=n-1)<=1)){e.next=5;break}return e.abrupt("return",Promise.resolve());case 5:return o=r%2===0?y:p,t.forEach((function(e){a.splice.apply(a,[e*b,b].concat(Object(l.a)(Array(b).fill(o))))})),P.updateState({body:Object(l.a)(a)}),e.next=10,A(200);case 10:return e.abrupt("return",H(t,r));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(m.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(t);case 2:n=P.state.home.body,t.forEach((function(e,t){n.splice((e-t)*b,b)})),n.unshift.apply(n,Object(l.a)(Array(b*t.length).fill(p))),P.updateState({body:Object(l.a)(n)});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=n(148),Y=function e(){var t=this;Object(R.a)(this,e),this.funs={},this.on=function(e,n){t.funs[e]=n},this.emit=function(e,n){t.funs[e]&&t.funs[e](n)},this.off=function(e){delete t.funs[e]}},F=new Y,W=n(65),X=n.n(W),B=(n(311),function(e){var t=e.type;return u.a.createElement("div",{className:X()("cube",{"cube--active":t===h,"cube--complete":t===y})})}),J=(n(312),Object(i.connect)((function(e){return{body:e.home.body}}))((function(e){var t=e.body;return u.a.createElement("div",{className:"game"},t.map((function(e,t){return u.a.createElement(B,{key:t,type:e})})))}))),z=n(149),$=(n(313),Object(i.connect)((function(e){return{nextShape:e.home.nextShape}}))((function(e){var t=e.nextShape,n=Object(c.useState)([]),a=Object(z.a)(n,2),r=a[0],o=a[1];return Object(c.useEffect)((function(){var e=P.nextShape,t=Array(12).fill(p);e.forEach((function(e,n){e.forEach((function(e,a){t[3*n+a]=e?y:p}))})),o(t)}),[t]),u.a.createElement("div",{className:"next"},r.map((function(e,t){return u.a.createElement(B,{key:t,type:e})})))}))),q=(n(314),Object(i.connect)((function(e){return{score:e.home.score}}))((function(e){var t=e.score;return u.a.createElement("div",{className:"info"},u.a.createElement("p",{className:"info__title"},"\u5f97\u5206"),u.a.createElement("p",null,t),u.a.createElement("p",{className:"info__title"},"\u4e0b\u4e00\u4e2a"),u.a.createElement($,null))}))),K=(n(315),function(){return u.a.createElement("div",{className:"game-area"},u.a.createElement("div",{className:"game-area__wrap"},u.a.createElement("div",{className:"game-area__container"},u.a.createElement(J,null),u.a.createElement(q,null))))}),Q=(n(316),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.className,n=e.text,a=e.onTouchStart,r=void 0===a?function(){}:a,o={className:X()("c-btn",t)};return k()?o.onTouchStart=r:o.onMouseDown=r,u.a.createElement("div",o,u.a.createElement("i",{className:"c-btn__icon"}),n&&u.a.createElement("p",null,n))}),U=function(e){var t=function(){F.emit(O)},n=function(){var e,t=(null===P||void 0===P||null===(e=P.state)||void 0===e?void 0:e.home).shape;T(t)||P.setY(function e(t){var n,a=(null===P||void 0===P||null===(n=P.state)||void 0===n?void 0:n.home)||{},r=a.x,o=void 0===r?0:r,c=a.y,u=t||(void 0===c?0:c);return D(o,u)?u-1:e(u+1)}()+1)},a=function(e){var t,n=(null===P||void 0===P||null===(t=P.state)||void 0===t?void 0:t.home)||{},a=n.x,r=n.y,o=function(e){var t=e.map((function(e){return e.length}));return Math.max.apply(Math,Object(l.a)(t))}(n.shape),c=a+x[e],u=c<0||c+o>b||C(c,r)?a:c;P.setX(u)},r=function(){a(E.LEFT)},o=function(){a(E.RIGHT)};return Object(c.useEffect)((function(){F.on(E.SPACE,t),F.on(E.DOWN,n),F.on(E.LEFT,r),F.on(E.RIGHT,o)}),[]),u.a.createElement("div",{className:"control"},u.a.createElement("div",null,u.a.createElement("div",{className:"control__core"},u.a.createElement(Q,{className:"control__btn--start",text:"\u5f00\u59cb",onTouchStart:function(){F.emit(S)}}),u.a.createElement(Q,{className:"control__btn--reset",text:"\u91cd\u73a9",onTouchStart:function(){F.emit(g)}})),u.a.createElement(Q,{className:"control__btn--change",text:"\u53d8\u5f62(SPACE)",onTouchStart:t})),u.a.createElement("div",{className:"control__direction"},u.a.createElement(Q,{className:"control__btn--left",text:"\u5de6\u79fb",onTouchStart:r}),u.a.createElement(Q,{className:"control__btn--right",text:"\u53f3\u79fb",onTouchStart:o}),u.a.createElement(Q,{className:"control__btn--down",text:"\u6389\u843d",onTouchStart:n})))},V=(n(317),!1),Z=Object(i.connect)((function(e){return e.home}))((function(e){var t=e.body,n=e.x,a=e.y,i=e.shape,s=e.nextShape,f=function(e){if(V){var t=e.keyCode;Object.values(E).includes(t)&&F.emit(t,{keyCode:t})}},v=function(){if(V){var e=T(s)?L():s,t={y:0,shape:e,nextShape:L(),x:Math.floor((b-1)/2)-w(e)};P.updateState(t)}},x=function(){V||(r||(r=f,document.addEventListener("keyup",f)),V=!0,v())},j=function(){M(),function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=P.state.home.body,r=N(a,b).length-1,o=void 0!==t?t:r,c=o<=0?1:n,u=o+n<0?0:o+c,i=n>0?p:y;if(!(o>r)){var s=o*b;a.splice.apply(a,[s,b].concat(Object(l.a)(Array(b).fill(i)))),P.updateState({body:Object(l.a)(a)}),setTimeout((function(){e(u,c)}),50)}}(),V=!1,console.log("\u6e38\u620f\u7ed3\u675f")},k=function(){var e=Object(m.a)(d.a.mark((function e(t){var n,a,r,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=P.state.home.body,a=N(n,b),t&&M(),r=a.reduce((function(e,t,n){return t.every((function(e){return e===y}))&&e.push(n),e}),[]),!(o=r.length>0)){e.next=11;break}return M(),console.log("\u6b63\u5728\u6267\u884c\u6d88\u9664, \u4e0b\u6807\u96c6\u5408: ",r),e.next=10,I(r);case 10:P.updateScore(r.length);case 11:n.slice(0,10).some((function(e){return e===y}))?j():(o||t)&&v();case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){V&&(M(),o=setTimeout((function(){P.setY(a+1)}),500))}),[a]),Object(c.useEffect)((function(){V&&function(){var e=t.map((function(e){return e===h?p:e})),r=D(n,a),o=r?a-1:a;i.forEach((function(t,a){t.forEach((function(t,c){1===t&&(e[(o-a)*b+n+c]=r?y:h)}))})),P.updateState({body:e}),k(r)}()}),[n,a,i]),Object(c.useEffect)((function(){F.on(S,x),F.on(g,j),F.on(O,A),function(){document.addEventListener("gesturestart",(function(e){e.preventDefault()}));var e=0;document.documentElement.addEventListener("touchend",(function(t){var n=Date.now();n-e<=300&&t.preventDefault(),e=n}),!1)}()}),[]);var A=function(){var e;if(V){var t=(null===P||void 0===P||null===(e=P.state)||void 0===e?void 0:e.home)||{},n=t.x,a=t.y,r=P.currentShape,o=r.length,c=r[0].length-1,u=function(){var e,t=(null===P||void 0===P||null===(e=P.state)||void 0===e?void 0:e.home)||{},n=t.x,a=t.y,r=t.body,o=N(r,b).length,c=P.currentShape[P.currentShape.length-1].findIndex((function(e){return 1===e})),u=r.slice(a*b,a*b+b),i=Array(o).fill("0").map((function(e,t){return r[t*b+n+c]})),s=G(u,n),l=G(i,a);return{x:Object.assign({min:0,max:b-1},s),y:Object.assign({min:0,max:o-1},l)}}(),i=u.x,s=u.y;if(!(i.max-i.min<o-1||a>=c&&a-s.min<c)){var f=r.reduce((function(e,t,n){return t.forEach((function(t,a){e[a]||(e[a]=Array(r.length)),e[a][r.length-1-n]=t})),e}),[]),d=_(f),m=function(e,t,n){return e<t?t:e>n?n:e}(n+w(r)-Math.floor(d/2),i.min,i.max-d+1);P.updateState({shape:Object(l.a)(f).reverse(),x:m})}}},M=function(){o&&(clearTimeout(o),o=null)};return u.a.createElement("div",{className:"index"},u.a.createElement("div",{className:"index__container"},u.a.createElement(K,null),u.a.createElement(U,null)))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ee=n(98),te={home:{namespace:"home",state:{x:0,y:-1,score:0,shape:[],nextShape:[],body:Array(150).fill("0")},reducers:{updateState:function(e,t){var n=t.payload,a=void 0===n?{}:n;return Object(ee.a)(Object(ee.a)({},e),a)}},effects:{setX:d.a.mark((function e(t,n){var a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.payload.x,r=n.put,e.next=4,r({type:"updateState",payload:{x:a}});case 4:case"end":return e.stop()}}),e)})),setY:d.a.mark((function e(t,n){var a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.payload.y,r=n.put,e.next=4,r({type:"updateState",payload:{y:a}});case 4:case"end":return e.stop()}}),e)})),updateScore:d.a.mark((function e(t,n){var a,r,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.payload.size,r=void 0===a?0:a,o=n.put,c=P.state.home.score+10*r,e.next=5,o({type:"updateState",payload:{score:c}});case 5:case"end":return e.stop()}}),e)}))}}},ne=function(e){Object.keys(te).forEach((function(t){e.model(te[t])}))},ae=(n(318),s()());window._dva=ae,ne(ae),ae.router((function(){return u.a.createElement(Z,null)})),ae.start("#root"),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},97:function(e){e.exports=JSON.parse("[[[1],[1],[1],[1]],[[1,0],[1,0],[1,1]],[[0,1,0],[1,1,1]],[[1,1],[1,1]],[[1,1,0],[0,1,1]]]")}},[[151,1,2]]]);
//# sourceMappingURL=main.0271862e.chunk.js.map