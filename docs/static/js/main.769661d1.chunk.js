(this.webpackJsonpinit=this.webpackJsonpinit||[]).push([[0],{151:function(e,t,n){e.exports=n(319)},218:function(e,t){},311:function(e,t,n){},312:function(e,t,n){},313:function(e,t,n){},314:function(e,t,n){},315:function(e,t,n){},316:function(e,t,n){},317:function(e,t,n){},318:function(e,t,n){},319:function(e,t,n){"use strict";n.r(t);var a,o,r,c=n(0),u=n.n(c),i=n(10),l=n.n(i),s=n(11),f=n.n(s),d=n(147),m=n(6),v=n(49),h="0",p="1",y="2",b=10,E={SPACE:32,LEFT:37,RIGHT:39,DOWN:40},x=(a={},Object(v.a)(a,E.LEFT,-1),Object(v.a)(a,E.RIGHT,1),a),S="START_GAME",g="RESET_GAME",O="SHAPE_CHANGE",_=n(96),j=function(e){var t;return(null===e||void 0===e||null===(t=e[0])||void 0===t?void 0:t.length)||0},w=function(e){return Math.floor(j(e)/2)},N=function(e,t){for(var n=[],a=0;a<e.length/t;a++)n.push(e.slice(t*a,t*a+t));return n},T=function(e){switch(Object.prototype.toString.call(e)){case"[object Array]":return e.length<=0;case"[object Object]":return Object.keys(e).length<=0;default:return void 0===e}},k=function(){return/Android|webOS|iPhone|iPad|BlackBerry/i.test(navigator.userAgent)},A=function(e){window._dva._store.dispatch(e)},M={updateState:function(e){A({type:"home/updateState",payload:e})},setX:function(e){A({type:"home/setX",payload:{x:e}})},setY:function(e){A({type:"home/setY",payload:{y:e}})},updateScore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;A({type:"home/updateScore",payload:{size:e}})},get state(){var e,t,n;return null===(e=window)||void 0===e||null===(t=e._dva)||void 0===t||null===(n=t._store)||void 0===n?void 0:n.getState()},get currentShape(){return Object(m.a)(this.state.home.shape).reverse()},get nextShape(){return Object(m.a)(this.state.home.nextShape).reverse()}},G=function(e,t){return e.reduce((function(e,n,a){return n===y&&(a<=t?e.min=a+1:a>t&&void 0===e.max&&(e.max=a-1)),e}),{})},L=function(){var e,t,n=(e=0,t=_.length-1,parseInt(Math.random()*(t-e+1)+e,10)),a=_[n];return Object(m.a)(a).reverse()},P=function(e,t,n){var a,o=(null===M||void 0===M||null===(a=M.state)||void 0===a?void 0:a.home)||{},r=o.shape,c=void 0===r?[]:r,u=o.body,i=n||c,l=!1,s=(void 0===u?[]:u).map((function(e){return e===p?h:e}));e:for(var f=0;f<i.length;f+=1)for(var d=0;d<i[f].length;d+=1){var m=(t-f)*b,v=e+d;if(1===i[f][d]&&s[m+v]===y){l={x:v,y:m};break e}}return l},C=function(e,t){var n,a=((null===M||void 0===M||null===(n=M.state)||void 0===n?void 0:n.home)||{}).body;return t>=N(void 0===a?[]:a,b).length||P(e,t)},D=n(148),H=function e(){var t=this;Object(D.a)(this,e),this.funs={},this.on=function(e,n){t.funs[e]=n},this.emit=function(e,n){t.funs[e]&&t.funs[e](n)},this.off=function(e){delete t.funs[e]}},I=new H,R=n(64),Y=n.n(R),F=(n(311),function(e){var t=e.type;return u.a.createElement("div",{className:Y()("cube",{"cube--active":t===p,"cube--complete":t===y})})}),W=(n(312),Object(i.connect)((function(e){return{body:e.home.body}}))((function(e){var t=e.body;return u.a.createElement("div",{className:"game"},t.map((function(e,t){return u.a.createElement(F,{key:t,type:e})})))}))),X=n(149),B=(n(313),Object(i.connect)((function(e){return{nextShape:e.home.nextShape}}))((function(e){var t=e.nextShape,n=Object(c.useState)([]),a=Object(X.a)(n,2),o=a[0],r=a[1];return Object(c.useEffect)((function(){var e=M.nextShape,t=Array(12).fill(h);e.forEach((function(e,n){e.forEach((function(e,a){t[3*n+a]=e?y:h}))})),r(t)}),[t]),u.a.createElement("div",{className:"next"},o.map((function(e,t){return u.a.createElement(F,{key:t,type:e})})))}))),J=(n(314),Object(i.connect)((function(e){return{score:e.home.score}}))((function(e){var t=e.score;return u.a.createElement("div",{className:"info"},u.a.createElement("p",{className:"info__title"},"\u5f97\u5206"),u.a.createElement("p",null,t),u.a.createElement("p",{className:"info__title"},"\u4e0b\u4e00\u4e2a"),u.a.createElement(B,null))}))),z=(n(315),function(){return u.a.createElement("div",{className:"game-area"},u.a.createElement("div",{className:"game-area__wrap"},u.a.createElement("div",{className:"game-area__container"},u.a.createElement(W,null),u.a.createElement(J,null))))}),$=(n(316),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.className,n=e.text,a=e.onTouchStart,o=void 0===a?function(){}:a,r={className:Y()("c-btn",t)};return k()?r.onTouchStart=o:r.onMouseDown=o,u.a.createElement("div",r,u.a.createElement("i",{className:"c-btn__icon"}),n&&u.a.createElement("p",null,n))}),q=function(e){var t=function(){I.emit(O)},n=function(){var e,t=(null===M||void 0===M||null===(e=M.state)||void 0===e?void 0:e.home).shape;T(t)||M.setY(function e(t){var n,a=(null===M||void 0===M||null===(n=M.state)||void 0===n?void 0:n.home)||{},o=a.x,r=void 0===o?0:o,c=a.y,u=t||(void 0===c?0:c);return C(r,u)?u-1:e(u+1)}()+1)},a=function(e){var t,n=(null===M||void 0===M||null===(t=M.state)||void 0===t?void 0:t.home)||{},a=n.x,o=n.y,r=function(e){var t=e.map((function(e){return e.length}));return Math.max.apply(Math,Object(m.a)(t))}(n.shape),c=a+x[e],u=c<0||c+r>b||P(c,o)?a:c;M.setX(u)},o=function(){a(E.LEFT)},r=function(){a(E.RIGHT)};return Object(c.useEffect)((function(){I.on(E.SPACE,t),I.on(E.DOWN,n),I.on(E.LEFT,o),I.on(E.RIGHT,r)}),[]),u.a.createElement("div",{className:"control"},u.a.createElement("div",null,u.a.createElement("div",{className:"control__core"},u.a.createElement($,{className:"control__btn--start",text:"\u5f00\u59cb",onTouchStart:function(){I.emit(S)}}),u.a.createElement($,{className:"control__btn--reset",text:"\u91cd\u73a9",onTouchStart:function(){I.emit(g)}})),u.a.createElement($,{className:"control__btn--change",text:"\u53d8\u5f62(SPACE)",onTouchStart:t})),u.a.createElement("div",{className:"control__direction"},u.a.createElement($,{className:"control__btn--left",text:"\u5de6\u79fb",onTouchStart:o}),u.a.createElement($,{className:"control__btn--right",text:"\u53f3\u79fb",onTouchStart:r}),u.a.createElement($,{className:"control__btn--down",text:"\u6389\u843d",onTouchStart:n})))},K=(n(317),!1),Q=Object(i.connect)((function(e){return e.home}))((function(e){var t=e.body,n=e.x,a=e.y,i=e.shape,l=e.nextShape,s=function(e){if(K){var t=e.keyCode;Object.values(E).includes(t)&&I.emit(t,{keyCode:t})}},v=function(){if(K){var e=T(l)?L():l,t={y:0,shape:e,nextShape:L(),x:Math.floor((b-1)/2)-w(e)};M.updateState(t)}},x=function(){K||(o||(o=s,document.addEventListener("keyup",s)),K=!0,v())},_=function(e,t){return new Promise((function(n){setTimeout((function(){e.forEach((function(e){t.splice(e*b,b),t.unshift.apply(t,Object(m.a)(Array(b).fill("0")))})),n()}),3e3)}))},k=function(){D(),function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=M.state.home.body,o=N(a,b).length-1,r=void 0!==t?t:o,c=r<=0?1:n,u=r+n<0?0:r+c,i=n>0?h:y;if(!(r>o)){var l=r*b;a.splice.apply(a,[l,b].concat(Object(m.a)(Array(b).fill(i)))),M.updateState({body:Object(m.a)(a)}),setTimeout((function(){e(u,c)}),50)}}(),K=!1,console.log("\u6e38\u620f\u7ed3\u675f")},A=function(){var e=Object(d.a)(f.a.mark((function e(t,n){var a,o,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=N(t,b),n&&D(),o=a.reduce((function(e,t,n){return t.every((function(e){return"2"===e}))&&e.push(n),e}),[]),!(r=o.length>0)){e.next=10;break}return D(),console.log("\u6b63\u5728\u6267\u884c\u6d88\u9664, \u4e0b\u6807\u96c6\u5408: ",o),e.next=9,_(o,t);case 9:M.updateScore(o.length);case 10:M.updateState({body:Object(m.a)(t)}),t.slice(0,10).some((function(e){return e===y}))?k():(r||n)&&v();case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){K&&(D(),r=setTimeout((function(){M.setY(a+1)}),500))}),[a]),Object(c.useEffect)((function(){K&&function(){var e=t.map((function(e){return e===p?h:e})),o=C(n,a),r=o?a-1:a;i.forEach((function(t,a){t.forEach((function(t,c){1===t&&(e[(r-a)*b+n+c]=o?y:p)}))})),M.updateState({body:e}),A(e,o)}()}),[n,a,i]),Object(c.useEffect)((function(){I.on(S,x),I.on(g,k),I.on(O,P),function(){document.addEventListener("gesturestart",(function(e){e.preventDefault()}));var e=0;document.documentElement.addEventListener("touchend",(function(t){var n=Date.now();n-e<=300&&t.preventDefault(),e=n}),!1)}()}),[]);var P=function(){var e;if(K){var t=(null===M||void 0===M||null===(e=M.state)||void 0===e?void 0:e.home)||{},n=t.x,a=t.y,o=M.currentShape,r=o.length,c=o[0].length-1,u=function(){var e,t=(null===M||void 0===M||null===(e=M.state)||void 0===e?void 0:e.home)||{},n=t.x,a=t.y,o=t.body,r=N(o,b).length,c=M.currentShape[M.currentShape.length-1].findIndex((function(e){return 1===e})),u=o.slice(a*b,a*b+b),i=Array(r).fill("0").map((function(e,t){return o[t*b+n+c]})),l=G(u,n),s=G(i,a);return{x:Object.assign({min:0,max:b-1},l),y:Object.assign({min:0,max:r-1},s)}}(),i=u.x,l=u.y;if(!(i.max-i.min<r-1||a>=c&&a-l.min<c)){var s=o.reduce((function(e,t,n){return t.forEach((function(t,a){e[a]||(e[a]=Array(o.length)),e[a][o.length-1-n]=t})),e}),[]),f=j(s),d=function(e,t,n){return e<t?t:e>n?n:e}(n+w(o)-Math.floor(f/2),i.min,i.max-f+1);M.updateState({shape:Object(m.a)(s).reverse(),x:d})}}},D=function(){r&&(clearTimeout(r),r=null)};return u.a.createElement("div",{className:"index"},u.a.createElement("div",{className:"index__container"},u.a.createElement(z,null),u.a.createElement(q,null)))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var U=n(97),V={home:{namespace:"home",state:{x:0,y:-1,score:0,shape:[],nextShape:[],body:Array(150).fill("0")},reducers:{updateState:function(e,t){var n=t.payload,a=void 0===n?{}:n;return Object(U.a)(Object(U.a)({},e),a)}},effects:{setX:f.a.mark((function e(t,n){var a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.payload.x,o=n.put,e.next=4,o({type:"updateState",payload:{x:a}});case 4:case"end":return e.stop()}}),e)})),setY:f.a.mark((function e(t,n){var a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.payload.y,o=n.put,e.next=4,o({type:"updateState",payload:{y:a}});case 4:case"end":return e.stop()}}),e)})),updateScore:f.a.mark((function e(t,n){var a,o,r,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.payload.size,o=void 0===a?0:a,r=n.put,c=M.state.home.score+10*o,e.next=5,r({type:"updateState",payload:{score:c}});case 5:case"end":return e.stop()}}),e)}))}}},Z=function(e){Object.keys(V).forEach((function(t){e.model(V[t])}))},ee=(n(318),l()());window._dva=ee,Z(ee),ee.router((function(){return u.a.createElement(Q,null)})),ee.start("#root"),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},96:function(e){e.exports=JSON.parse("[[[1],[1],[1],[1]],[[1,0],[1,0],[1,1]],[[0,1,0],[1,1,1]],[[1,1],[1,1]],[[1,1,0],[0,1,1]]]")}},[[151,1,2]]]);
//# sourceMappingURL=main.769661d1.chunk.js.map